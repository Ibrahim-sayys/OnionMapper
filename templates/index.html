{% extends "base.html" %}
{% block title %}Onion Mapper{% endblock %}
{% block content %}
<div class="main-container">
    <div class="branding">
        <h1>Onion Mapper</h1>
        <p>Smart .onion site classifier & categorizer using ML models.</p>
    </div>
    <form method="POST" action="/" class="form-card" id="main-form">
        <div class="mb-3">
            <label for="onion_url" class="form-label">Enter Onion URL:</label>
            <input type="text" id="onion_url" name="onion_url" class="form-control" placeholder="e.g. abcdefg1234567.onion" required autocomplete="off" />
        </div>
        <div class="mb-3">
            <label class="form-label" for="model">Select Model:</label>
            <select id="model" name="model" class="form-select">
                {% for key, name in model_choices %}
                    <option value="{{ key }}" {% if key == selected_model %}selected{% endif %}>{{ name }}</option>
                {% endfor %}
            </select>
        </div>
        <button type="submit" class="btn btn-custom">Predict Category</button>
    </form>

    {% if error %}
        <div class="alert alert-danger alert-dismissible fade show mt-3" role="alert">
            {{ error }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    {% endif %}

    {% if category %}
        <div class="alert alert-success alert-dismissible fade show result-card mt-3" role="alert" style="border: 1.5px solid #00ffb4;">
            <strong>Predicted Category ({{ model_choices | selectattr("0", "equalto", selected_model) | map(attribute="1") | first }}):</strong> {{ category }}
            {% if extracted_keywords %}
                <p class="keywords">Keywords used: {{ extracted_keywords }}</p>
            {% endif %}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    {% endif %}

    <div class="footer">
        &copy; 2025 Onion Mapper  <br> Made with &#10084;&#65039; by Syed Ibrahim and Hassan Arshad
    </div>
</div>
<!-- Bootstrap 5 JS (for tabs and navbar) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    // Optional: If you want the About tabs to scroll into view and activate from navbar
    function showTab(tabId) {
        var tabTrigger = new bootstrap.Tab(document.querySelector('[data-bs-target="#' + tabId + '"]'));
        tabTrigger.show();
        document.getElementById(tabId).scrollIntoView({ behavior: 'smooth' });
        event.preventDefault();
    }
</script>
{% endblock %}